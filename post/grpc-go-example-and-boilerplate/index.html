<!DOCTYPE html>
<html lang="en">
<head prefix="og: http://ogp.me/ns# article: http://ogp.me/ns/article# website: http://ogp.me/ns/website#">
    <meta http-equiv="content-type" content="text/html; charset=utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">
    <meta name="description" content="A minimal repo containing all the boilerplate for getting started with gRPC in Go">
    <meta name="keywords" content="go, grpc, getting started">
    <meta property="og:title" content="gRPC Go Example and Boilerplate">
    
    <meta property="og:type" content="article">
    <meta property="article:published_time" content="2023-02-12">
    
    <meta property="og:description" content="A minimal repo containing all the boilerplate for getting started with gRPC in Go">
    <meta property="og:url" content="https://gloutnikov.com/post/grpc-go-example-and-boilerplate/">
    <meta property="og:site_name" content="Stefan Gloutnikov">
    
    <meta property="og:tags" content="grpc">
    
    <meta property="og:tags" content="go">
    
    <meta property="og:tags" content="getting-started">
    
    <meta name="generator" content="Hugo 0.145.0">
    <title>gRPC Go Example and Boilerplate - Stefan Gloutnikov</title>
    
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.2/css/all.min.css">
    
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/10.7.1/styles/darcula.min.css">
    
    <link rel="stylesheet" href="https://gloutnikov.com/css/style.css">
    
    

    
    
</head>
<body>

<nav class="navbar navbar-default navbar-fixed-top visible-xs">
	<div class="container-fluid">
		<div class="navbar-header">
			<button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
				<span class="sr-only">Toggle navigation</span>
				<span class="icon-bar"></span>
				<span class="icon-bar"></span>
				<span class="icon-bar"></span>
			</button>
			
				<a class="navbar-brand" href="https://gloutnikov.com/">Stefan Gloutnikov</a>
			
		</div>
		<div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
			<ul class="nav navbar-nav">
				
				
					<li><a href="https://gloutnikov.com/aboutme/">About Me</a></li>
				
					<li><a href="https://gloutnikov.com/">Blog</a></li>
				
					<li><a href="https://gloutnikov.com/projects/">Projects</a></li>
				
					<li><a href="https://gloutnikov.com/quotes/">Quotes</a></li>
				
					<li><a href="https://gloutnikov.com/">Notes</a></li>
				
			</ul>
		</div>
	</div>
</nav>
<div class="container-fluid">
	<div class="row">
		<div id="menu" class="hidden-xs col-sm-4 col-md-3">
	<div id="menu-content" class="vertical-align">
		
			<h1 class="text-center"><a href="https://gloutnikov.com/">Stefan Gloutnikov</a></h1>
		
		
		
			<small class="text-center center-block">Software Engineer</small>
		
		
		
			<img id="profile-pic" src="https://gloutnikov.com//img/profile.jpg" alt="My Picture" class="img-circle center-block">
		
		<div id="social" class="text-center">
			
				<a href="https://www.linkedin.com/in/sgloutnikov"><i class="fab fa-linkedin fa-2x"></i></a>
			
				<a href="https://github.com/sgloutnikov"><i class="fab fa-github fa-2x"></i></a>
			
				<a href="https://bsky.app/profile/gloutnikov.com"><i class="fab fa-bluesky fa-2x"></i></a>
			
				<a href="https://mastodon.social/@sgloutnikov"><i class="fab fa-mastodon fa-2x"></i></a>
			
				<a href="https://keybase.io/sgloutnikov"><i class="fab fa-keybase fa-2x"></i></a>
			

			<a href="mailto:stefan@gloutnikov.com"><i class="far fa-envelope fa-2x"></i></a>
		</div>
		<div id="links" class="text-center">
			
			
				
					<a href="https://gloutnikov.com/aboutme/">About Me</a>
				
			
				
					<a href="https://gloutnikov.com/">Blog</a>
				
			
				
					<a href="https://gloutnikov.com/projects/">Projects</a>
				
			
				
					<a href="https://gloutnikov.com/quotes/">Quotes</a>
				
			
				
					<a href="https://notes.gloutnikov.com">Notes</a>
				
			
		</div>
	</div>
</div>

		<div id="content" class="col-xs-12 col-sm-8 col-md-9">
			<div class="row">
				<div id="post" class="col-sm-offset-1 col-sm-10 col-md-10 col-lg-7">

<main>
	<header>
		<h1>gRPC Go Example and Boilerplate</h1>
	</header>

	<small>
		12 February 2023
		<br><br>
	</small>

	<article>
		<p>I put together a simple example and all the boilerplate needed to get started with a gRPC service in Go. The following Git repository includes some of what I consider best practices, useful middleware, observability, and other features.</p>
<p><strong>Git Repository: <a href="https://github.com/sgloutnikov/grpc-go-boilerplate" target="_blank">grpc-go-boilerplate</a></strong></p>
<p>The following Git repository includes a &ldquo;Hello world&rdquo; gRPC service with multiple features and best practices. Please feel free to clone, try, and modify it per your needs.</p>
<h2 id="features">Features</h2>
<p>I have included multiple features in this project, some of which took me considerable time to figure out and implement. Going forward, starting new gRPC services should be much quicker given this boilerplate.</p>
<h3 id="example-grpc-service">Example gRPC Service</h3>
<p>The Hello service is quite a simple service which does not take any input, and calling it simply returns a string. The service definitions are inside the <code>proto</code> directory and implementation inside the <code>internal/hello</code> directory.</p>
<h3 id="protobuf-compilation">Protobuf Compilation</h3>
<p>Protobuf compilation is built right into the Go project with <a href="https://buf.build" target="_blank"><code>buf</code></a>, so no external dependencies like installing the <code>protoc</code> compiler are needed on the system. Compile the protobuf definitions by either running <code>make generate</code> or <code>go generate ./...</code>. For more information regarding how everything fits together refer to the blog post linked at the end, and the <code>buf</code> <a href="https://docs.buf.build/introduction" target="_blank">documentation</a>.</p>
<h3 id="structured-logging--logging-middleware">Structured Logging &amp; Logging Middleware</h3>
<p>The project leverages <a href="https://github.com/rs/zerolog" target="_blank"><code>zerolog</code></a> for its logging library. It is my favorite Go logging library and I recommend using it because of its features and performance. When in <code>dev</code> mode the logging is setup to be more human readable and set to JSON otherwise for production deployments.</p>
<h3 id="panic-recovery-interceptor">Panic Recovery Interceptor</h3>
<p>Included is a panic recovery <a href="https://github.com/grpc-ecosystem/go-grpc-middleware/tree/v2" target="_blank">interceptor middleware</a> that turns panics into gRPC errors. The recovery interceptor is a middleware that recovers from panics and logs the panic message&ndash;the last thing we want is a panic to bring down our entire server.</p>
<h3 id="prometheus-interceptor">Prometheus Interceptor</h3>
<p>To improve observability and metrics included is the Prometheus <a href="https://github.com/grpc-ecosystem/go-grpc-middleware/tree/v2" target="_blank">interceptor middleware</a> that adds gRPC specific metrics. Prometheus metrics are available on the <code>:2112/metrics</code> endpoint when the service is running.</p>
<h3 id="health-check-service">Health Check Service</h3>
<p>An example health check <a href="https://github.com/grpc/grpc/blob/master/doc/health-checking.md" target="_blank">service</a> is provided for health checks, and readiness + liveliness probes if deploying on Kubernetes. The Hello service health service implementation is very basic, and in a real scenario some more logic needs to be implemented depending on your service.</p>
<h3 id="buf--plugins-integration"><code>buf</code> &amp; Plugins Integration</h3>
<p><a href="https://buf.build" target="_blank"><code>buf</code></a> is a very useful tool when working with Protobuf. It helps with things like compilation, linting, breaking change detection, and more. Configuration can be found inside the <code>buf.yaml</code> and <code>buf.gen.yaml</code> files. Refer to their documentation for further details.</p>
<h3 id="prometheus-metrics">Prometheus Metrics</h3>
<p>Example setup of Prometheus Metrics. Various Prometheus metrics are available on the <code>:2112/metrics</code> endpoint when the service is running.</p>
<h3 id="versioned-apis">Versioned APIs</h3>
<p>It is a good idea to version our APIs to support us going forward with introducing breaking changes. The proto files are structured inside the <code>proto</code> folder as follows: <code>service/vN/file.proto</code>. And the package definition inside the protobuf files: <code>package service.vN;</code></p>
<h3 id="dev-mode-toggle">Dev Mode Toggle</h3>
<p>Sometimes it is useful to run your service locally during development. This could mean mocking out certain dependencies, services or what not. This can be done by providing a <code>-dev</code> argument when running the service to allow for branching and handling of such cases. Refer to the <code>main</code> function for an example.</p>
<h3 id="protobuf--code-linting">Protobuf &amp; Code Linting</h3>
<p>Go code linting is handled by <a href="https://golangci-lint.run" target="_blank">golangci-lint</a> and protobuf linting via the <a href="https://buf.build/" target="_blank">buf</a> tool. Run <code>make lint</code> to run both and see if there are any problems detected with your code or protobuf files.</p>
<h3 id="graceful-shutdown">Graceful Shutdown</h3>
<p>The service can be stopped by issuing an interrupt (Ctrl+C), after which any additional internal services can be notified (via a shared <code>Context</code>) and are given 5 seconds to perform any clean-up. When either all additional internal services complete their cleanup, 5 seconds pass, or another interrupt is issued, the main service terminates. The time can be configured, and the basic framework can be found inside <code>cmd/grpc-go-boilerplate/main.go</code>.</p>
<h3 id="makefile">Makefile</h3>
<p>The <code>Makefule</code> provides several useful targets for things like compiling our protobuf and running the code/proto lint. Review the file for more details.</p>
<h3 id="dockerfile">Dockerfile</h3>
<p>The file <code>docker/Dockerfile</code> demonstrates how to build a docker image of our service, including pulling dependencies and compiling our protobuf.</p>
<h3 id="grpc-gateway-integration">gRPC Gateway Integration</h3>
<p><a href="https://grpc-ecosystem.github.io/grpc-gateway/" target="_blank">gRPC Gateway</a> is a <code>protoc</code> plugin that reads a gRPC service definition and generates a reverse-proxy server which translates a RESTful JSON API into gRPC. The <code>google.api.http</code> option service annotations inside the <code>hello.proto</code> file are used with this plugin. If your project has the need to use such a plugin, it is included in this project, and we will see how to use it in a section below.</p>
<h3 id="no-generated-code-committed">No Generated Code Committed</h3>
<p>It is a preference of mine not to have generated code be committed inside the Git repository. For that reason, any generated code for the project results in the <code>gen</code> directory, and that directory is Git ignored.</p>
<h2 id="run-server">Run Server</h2>
<p>Let&rsquo;s look at an example of running the service and calling it with a client. Download all project dependencies, compile protobuf, and run:</p>
<div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>go mod download all
</span></span><span style="display:flex;"><span>make generate <span style="color:#007f7f"># or go generate ./...</span>
</span></span><span style="display:flex;"><span>go run cmd/grpc-go-boilerplate/main.go -dev
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>... INF gRPC server listening on :8080
</span></span><span style="display:flex;"><span>... INF metrics available on :2112/metrics
</span></span><span style="display:flex;"><span>... INF gRPC Gateway listening on :8081
</span></span></code></pre></div><h2 id="run-client">Run Client</h2>
<p>Call our Hello gRPC service:</p>
<div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>grpcurl --plaintext localhost:8080 hello.v1.HelloService/Hello
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  <span style="color:#0ff;font-weight:bold">&#34;hello&#34;</span>: <span style="color:#0ff;font-weight:bold">&#34;Hello world!&#34;</span>
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>Call the service using the gRPC Gateway:</p>
<div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>curl localhost:8081/v1/hello
</span></span><span style="display:flex;"><span>{<span style="color:#0ff;font-weight:bold">&#34;hello&#34;</span>:<span style="color:#0ff;font-weight:bold">&#34;Hello world!&#34;</span>}
</span></span></code></pre></div><p>Calling the health service using <code>grpc-health-probe</code>:</p>
<div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>grpc-health-probe -addr <span style="color:#0ff;font-weight:bold">&#34;:8080&#34;</span> -service=<span style="color:#0ff;font-weight:bold">&#34;hello.v1.HelloService&#34;</span>
</span></span><span style="display:flex;"><span>status: SERVING
</span></span><span style="display:flex;"><span>grpc-health-probe -addr <span style="color:#0ff;font-weight:bold">&#34;:8080&#34;</span>
</span></span><span style="display:flex;"><span>status: SERVING
</span></span></code></pre></div><h2 id="acknowledgements">Acknowledgements</h2>
<ul>
<li><a href="https://jbrandhorst.com/post/plugin-versioning/" target="_blank">Go Protobuf Plugin Versioning</a></li>
</ul>
	</article>
</main>

<br>
<div id="bottom-nav" class="text-center center-block">
	<a href=" https://gloutnikov.com/" class="btn btn-default"><i class="fas fa-home"></i> Home</a>
</div>


  <div id="disqus_thread"></div>
<script>
    window.disqus_config = function () {
    
    
    
    };
    (function() {
        if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
            document.getElementById('disqus_thread').innerHTML = 'Disqus comments not available by default when the website is previewed locally.';
            return;
        }
        var d = document, s = d.createElement('script'); s.async = true;
        s.src = '//' + "sgloutnikov" + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>


						</div>
					</div>
				</div>
			</div>
		</div>
  </div>
  
  
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-GFG2Y6XSY5"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'G-GFG2Y6XSY5');
  </script>
  
  <script src="//cdnjs.cloudflare.com/ajax/libs/jquery/2.2.4/jquery.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js"></script>
  
  
  <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/10.7.1/highlight.min.js"></script>
  
  <script src="https://gloutnikov.com//js/App.js"></script>
  
</body>
</html>
